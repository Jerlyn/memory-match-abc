<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Memory Match</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@600;700&display=swap" rel="stylesheet">
    <style>
        /* Core CSS */
        :root {
            --primary-color: #2196F3;
            --primary-dark: #1976D2;
            --primary-light: #BBDEFB;
            --accent-color: #FF4081;
            --text-color: #212121;
            --text-secondary: #757575;
            --background-color: #FAFAFA;
            --card-back-bg: #A4D783; /* Light green background for cards */
            --card-back-dots: #FFFFFF; /* White polka dots */
            --success-color: #4CAF50;
            --error-color: #F44336;
            --border-radius: 12px;
            --container-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            --card-shadow: 0 3px 6px rgba(0, 0, 0, 0.08);
            --font-family: 'Baloo 2', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            --transition-fast: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-standard: 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: var(--font-family);
            background-color: var(--background-color);
            background: linear-gradient(135deg, #E3F2FD 0%, #FAFAFA 100%);
            color: var(--text-color);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1rem;
        }

        .game-container {
            width: 100%;
            max-width: 800px;
            margin: 0 auto;
            background-color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--container-shadow);
            padding: 1.5rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
            position: relative;
            overflow: hidden;
        }

        /* Reordered layout - header at top, game in middle, scores at bottom */
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1.5rem;
        }

        h1 {
            font-size: 2.8rem;
            color: var(--primary-color);
            font-weight: 700;
            margin: 0;
            flex-grow: 1;
            font-family: 'Baloo 2', cursive;
            letter-spacing: 0.5px;
            text-align: center;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
            margin: 0 auto 1.5rem;
            width: 100%;
            max-width: 600px;
        }

        .bottom-bar {
            display: flex;
            align-items: center;
            width: 100%;
            justify-content: space-between;
            background-color: #F5F9FF;
            border-radius: var(--border-radius);
            padding: 0.75rem 1rem;
            margin-top: 0.5rem;
            border: 1px solid rgba(33, 150, 243, 0.1);
        }

        .score-panel {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            flex: 1;
        }

        .score-item {
            display: flex;
            align-items: center;
            font-weight: 600;
            color: var(--text-color);
            font-size: 1.25rem;
            gap: 6px;
        }

        .score-item .material-icons {
            color: var(--primary-color);
            font-size: 28px;
        }

        .progress-container {
            flex: 1;
            max-width: 250px;
        }

        .progress-bar {
            height: 10px;
            background-color: #E0E0E0;
            border-radius: 6px;
            overflow: hidden;
            width: 100%;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }

        .progress-fill {
            height: 100%;
            background-color: var(--success-color);
            width: 0%;
            transition: width 0.4s ease;
        }

        .icon-button {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            padding: 8px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color var(--transition-fast);
            outline: none;
            margin-left: 15px;
        }

        .icon-button .material-icons {
            font-size: 32px; /* Larger icon */
        }

        .icon-button:hover {
            background-color: rgba(33, 150, 243, 0.1);
        }

        /* Settings modal - Updated as requested */
        .settings-content {
            width: 450px;
            max-width: 90%;
            padding: 0;
        }

        .modal-header {
            position: relative;
            padding: 1.5rem 1.5rem 1rem;
            display: flex;
            justify-content: center;
        }

        .modal-header h2 {
            color: #4CAF50;
            font-size: 2.2rem;
            text-align: center;
            margin: 0;
        }

        .close-button {
            position: absolute;
            right: 1rem;
            top: 1rem;
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color var(--transition-fast);
            outline: none;
        }

        .close-button:hover {
            color: var(--error-color);
        }

        .settings-body {
            padding: 1.5rem;
        }

        .settings-section {
            margin-bottom: 1.5rem;
        }

        .settings-section h3 {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.5rem;
            margin-bottom: 1rem;
            color: var(--primary-color);
        }

        /* Updated radio options styling */
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 0.75rem;
            margin-top: 0.8rem;
        }

        .option-container {
            position: relative;
            display: flex;
            align-items: center;
            padding: 1rem;
            border-radius: 12px;
            background-color: #F0F8FF;
            cursor: pointer;
            user-select: none;
            transition: background-color var(--transition-fast);
        }

        .option-container.selected {
            background-color: #E3F2FD;
        }

        .radio-icon {
            width: 24px;
            height: 24px;
            border-radius: 50%;
            border: 2px solid #BBDEFB;
            margin-right: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .radio-icon .material-icons {
            color: var(--primary-color);
            font-size: 20px;
            display: none;
        }

        .option-container.selected .radio-icon {
            border-color: var(--primary-color);
            background-color: white;
        }

        .option-container.selected .radio-icon .material-icons {
            display: block;
        }

        .option-label {
            display: flex;
            align-items: center;
            font-size: 1.2rem;
            font-weight: 500;
        }

        .option-icon {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 10px;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        /* Hide actual radio inputs */
        input[type="radio"] {
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        .primary-btn {
            background-color: var(--primary-color);
            color: white;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: var(--font-family);
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-standard);
            display: block;
            width: 100%;
            margin-top: 1.5rem;
        }

        .primary-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }

        .card {
            aspect-ratio: 1/1;
            cursor: pointer;
            transition: transform var(--transition-fast);
            position: relative;
        }

        .card:hover {
            transform: scale(1.02);
        }

        .card-front, .card-back {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.2rem;
            font-weight: 700;
            user-select: none;
            box-shadow: var(--card-shadow);
            transition: transform 0.6s ease, opacity 0.6s ease;
        }

        .card-front {
            background-color: white;
            border: 2px solid var(--primary-light);
            opacity: 0;
            transform: rotateY(90deg);
        }

        /* Simplified card back - just solid color with subtle dots */
        .card-back {
            background-color: var(--card-back-bg);
            background-image: radial-gradient(var(--card-back-dots) 12%, transparent 12%);
            background-size: 24px 24px;
            background-position: 0 0, 12px 12px;
            opacity: 1;
            border-radius: 12px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        /* When flipped, show front and hide back */
        .card.flipped .card-front {
            opacity: 1;
            transform: rotateY(0deg);
        }

        .card.flipped .card-back {
            opacity: 0;
            transform: rotateY(90deg);
        }

        .uppercase {
            color: #2196F3;
            font-size: 3rem;
            font-weight: bold;
        }

        .lowercase {
            color: #1976D2;
            font-size: 3rem;
            font-weight: bold;
        }

        .number-symbol {
            color: #2196F3;
            font-size: 3rem;
            font-weight: bold;
        }

        .number-count {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            max-width: 70%;
            gap: 5px;
        }

        .number-count-item {
            width: 12px;
            height: 12px;
            background-color: #1976D2;
            border-radius: 50%;
        }

        .matched .card-front {
            border-color: var(--success-color);
            background-color: rgba(76, 175, 80, 0.05);
        }

        /* Match animations */
        .matched-animation {
            animation: match-pulse 0.5s ease;
        }

        @keyframes match-pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }

        .no-match-animation {
            animation: no-match-shake 0.4s ease;
        }

        @keyframes no-match-shake {
            0% { transform: translateX(0); }
            25% { transform: translateX(-5px); }
            50% { transform: translateX(5px); }
            75% { transform: translateX(-5px); }
            100% { transform: translateX(0); }
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(3px);
        }

        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            max-width: 90%;
            width: 400px;
            box-shadow: var(--container-shadow);
            position: relative;
            overflow: hidden;
            animation: popIn 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        @keyframes popIn {
            from { transform: scale(0.9); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }

        .success-modal-content h2 {
            color: var(--success-color);
            margin-bottom: 1.2rem;
            font-size: 2rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .success-modal-content {
            padding: 2rem;
            text-align: center;
        }

        .success-modal-content p {
            font-size: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .trophy {
            margin: 1.5rem 0;
            text-align: center;
        }

        .trophy-icon {
            font-size: 3.5rem;
            color: #FFC107;
        }

        .success-icon {
            font-size: 1.5rem;
            margin-right: 8px;
            color: var(--success-color);
        }

        .success-modal-btn {
            margin: 0 auto;
            display: block;
            min-width: 180px;
            padding: 0.8rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-family: var(--font-family);
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-standard);
            outline: none;
            background-color: var(--primary-color);
            color: white;
        }

        .success-modal-btn:hover {
            transform: translateY(-2px);
            filter: brightness(1.05);
        }

        /* Responsive design */
        @media (min-width: 500px) {
            .game-board {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .game-board.medium {
                grid-template-columns: repeat(6, 1fr);
            }
        }

        @media (max-width: 499px) {
            h1 {
                font-size: 2.2rem;
            }
            
            .header-top {
                flex-direction: row;
                gap: 0.5rem;
                justify-content: center;
                align-items: center;
            }
            
            .bottom-bar {
                flex-direction: column;
                gap: 0.75rem;
                padding: 0.75rem;
            }
            
            .score-panel {
                width: 100%;
                justify-content: space-between;
            }
            
            .progress-container {
                max-width: none;
                width: 100%;
            }
            
            .card-front, .card-back {
                font-size: 1.8rem;
            }
            
            .game-board {
                grid-template-columns: repeat(3, 1fr);
                gap: 10px;
            }
            
            .game-board.medium {
                grid-template-columns: repeat(4, 1fr);
            }
            
            .modal-content {
                padding: 1rem;
            }
        }

        @media (max-width: 350px) {
            .score-panel {
                flex-direction: column;
                gap: 0.5rem;
                align-items: flex-start;
            }
            
            .card-front, .card-back {
                font-size: 1.5rem;
            }
        }

        /* Animation for fall (confetti) */
        @keyframes fall {
            to {
                transform: translateY(400px) rotate(720deg);
                opacity: 0;
            }
        }

        .confetti-wrapper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
            pointer-events: none;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- Header at top -->
        <div class="header-top">
            <h1>Memory Match</h1>
            <button id="settings-button" class="icon-button" aria-label="Game settings">
                <span class="material-icons">settings</span>
            </button>
        </div>
        
        <!-- Game board in middle -->
        <div id="game-board" class="game-board" aria-label="Memory match game board"></div>
        
        <!-- Progress bar and scores at bottom -->
        <div class="bottom-bar">
            <div class="score-panel">
                <div class="score-item">
                    <span class="material-icons">check_circle</span>
                    <span id="match-count">0</span>/<span id="total-pairs">6</span>
                </div>
                <div class="score-item">
                    <span class="material-icons">replay</span>
                    <span id="attempt-count">0</span>
                </div>
            </div>
            <div class="progress-container">
                <div class="progress-bar">
                    <div id="progress-fill" class="progress-fill"></div>
                </div>
            </div>
        </div>

        <!-- Settings modal with updated styling -->
        <div id="settings-modal" class="modal" role="dialog" aria-labelledby="settings-title" inert>
            <div class="modal-content settings-content">
                <div class="modal-header">
                    <h2 id="settings-title">Game Settings</h2>
                    <button id="close-settings" class="close-button" aria-label="Close settings">
                        <span class="material-icons">close</span>
                    </button>
                </div>
                <div class="settings-body">
                    <div class="settings-section">
                        <h3>
                            <span class="material-icons" style="color: #2196F3;">category</span>
                            Game Mode
                        </h3>
                        <div class="radio-group">
                            <label class="option-container selected" id="letters-option">
                                <input type="radio" name="game-mode" id="letters-mode" value="letters" checked>
                                <span class="radio-icon">
                                    <span class="material-icons">check</span>
                                </span>
                                <span class="option-label">
                                    <span class="option-icon">
                                        <span class="material-icons">text_fields</span>
                                    </span>
                                    Letters
                                </span>
                            </label>
                            
                            <label class="option-container" id="numbers-option">
                                <input type="radio" name="game-mode" id="numbers-mode" value="numbers">
                                <span class="radio-icon">
                                    <span class="material-icons">check</span>
                                </span>
                                <span class="option-label">
                                    <span class="option-icon">
                                        <span class="material-icons">tag</span>
                                    </span>
                                    Numbers
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <div class="settings-section">
                        <h3>
                            <span class="material-icons" style="color: #2196F3;">stars</span>
                            Difficulty
                        </h3>
                        <div class="radio-group">
                            <label class="option-container selected" id="easy-option">
                                <input type="radio" name="difficulty" id="easy-mode" value="easy" checked>
                                <span class="radio-icon">
                                    <span class="material-icons">check</span>
                                </span>
                                <span class="option-label">
                                    <span class="option-icon">
                                        <span class="material-icons">sentiment_satisfied</span>
                                    </span>
                                    Easy (6 pairs)
                                </span>
                            </label>
                            
                            <label class="option-container" id="medium-option">
                                <input type="radio" name="difficulty" id="medium-mode" value="medium">
                                <span class="radio-icon">
                                    <span class="material-icons">check</span>
                                </span>
                                <span class="option-label">
                                    <span class="option-icon">
                                        <span class="material-icons">rocket_launch</span>
                                    </span>
                                    Medium (9 pairs)
                                </span>
                            </label>
                        </div>
                    </div>
                    
                    <button id="apply-settings" class="primary-btn">
                        Apply & Start New Game
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Success modal -->
        <div id="success-modal" class="modal" role="dialog" aria-labelledby="success-title" inert>
            <div class="modal-content success-modal-content">
                <div class="confetti-wrapper"></div>
                <h2 id="success-title">
                    <span class="material-icons success-icon">celebration</span>
                    You did it!
                </h2>
                <p>You found all the matches in <span id="final-attempts">0</span> attempts!</p>
                <div class="trophy">
                    <span class="material-icons trophy-icon">emoji_events</span>
                </div>
                <button id="play-again" class="success-modal-btn">
                    <span class="material-icons">replay</span> Play Again
                </button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Game elements
            const gameBoard = document.getElementById('game-board');
            const settingsButton = document.getElementById('settings-button');
            const settingsModal = document.getElementById('settings-modal');
            const closeSettingsButton = document.getElementById('close-settings');
            const applySettingsButton = document.getElementById('apply-settings');
            const lettersMode = document.getElementById('letters-mode');
            const numbersMode = document.getElementById('numbers-mode');
            const easyMode = document.getElementById('easy-mode');
            const mediumMode = document.getElementById('medium-mode');
            const lettersOption = document.getElementById('letters-option');
            const numbersOption = document.getElementById('numbers-option');
            const easyOption = document.getElementById('easy-option');
            const mediumOption = document.getElementById('medium-option');
            const matchCount = document.getElementById('match-count');
            const totalPairsElement = document.getElementById('total-pairs');
            const attemptCount = document.getElementById('attempt-count');
            const progressFill = document.getElementById('progress-fill');
            const successModal = document.getElementById('success-modal');
            const finalAttempts = document.getElementById('final-attempts');
            const playAgainButton = document.getElementById('play-again');
            const confettiWrapper = document.querySelector('.confetti-wrapper');

            // Game state
            let firstCard = null;
            let secondCard = null;
            let lockBoard = false;
            let matches = 0;
            let attempts = 0;
            let totalPairs = 6; // Default (easy mode)
            let cardsData = [];
            
            // Settings modal controls - using inert instead of aria-hidden
            settingsButton.addEventListener('click', () => {
                settingsModal.classList.add('active');
                settingsModal.removeAttribute('inert');
            });
            
            closeSettingsButton.addEventListener('click', () => {
                settingsModal.classList.remove('active');
                settingsModal.setAttribute('inert', '');
            });
            
            applySettingsButton.addEventListener('click', () => {
                settingsModal.classList.remove('active');
                settingsModal.setAttribute('inert', '');
                startGame();
            });
            
            // Updated radio options handlers
            lettersMode.addEventListener('change', () => {
                if (lettersMode.checked) {
                    lettersOption.classList.add('selected');
                    numbersOption.classList.remove('selected');
                }
            });
            
            numbersMode.addEventListener('change', () => {
                if (numbersMode.checked) {
                    numbersOption.classList.add('selected');
                    lettersOption.classList.remove('selected');
                }
            });
            
            easyMode.addEventListener('change', () => {
                if (easyMode.checked) {
                    totalPairs = 6;
                    easyOption.classList.add('selected');
                    mediumOption.classList.remove('selected');
                }
                totalPairsElement.textContent = totalPairs;
            });

            mediumMode.addEventListener('change', () => {
                if (mediumMode.checked) {
                    totalPairs = 9;
                    mediumOption.classList.add('selected');
                    easyOption.classList.remove('selected');
                }
                totalPairsElement.textContent = totalPairs;
            });

            // Initialize game
            playAgainButton.addEventListener('click', () => {
                successModal.classList.remove('active');
                successModal.setAttribute('inert', '');
                startGame();
            });

            // Generate the card data based on game mode
            function generateCardsData() {
                cardsData = [];
                
                if (lettersMode.checked) {
                    // Letters A-Z (uppercase and lowercase pairs)
                    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
                    const selectedLetters = letters.substring(0, totalPairs);
                    
                    for (let i = 0; i < selectedLetters.length; i++) {
                        const letter = selectedLetters[i];
                        cardsData.push(
                            { id: `upper-${letter}`, value: letter, class: 'uppercase', match: `lower-${letter.toLowerCase()}` },
                            { id: `lower-${letter.toLowerCase()}`, value: letter.toLowerCase(), class: 'lowercase', match: `upper-${letter}` }
                        );
                    }
                } else {
                    // Numbers 1-9 with their quantities
                    const numbers = [1, 2, 3, 4, 5, 6, 7, 8, 9].slice(0, totalPairs);
                    
                    for (let i = 0; i < numbers.length; i++) {
                        const num = numbers[i];
                        cardsData.push(
                            { id: `num-${num}`, value: num, class: 'number-symbol', match: `count-${num}` },
                            { 
                                id: `count-${num}`, 
                                value: num, 
                                class: 'number-count', 
                                match: `num-${num}`,
                                count: num
                            }
                        );
                    }
                }
                
                return shuffleArray(cardsData);
            }

            // Fisher-Yates shuffle algorithm
            function shuffleArray(array) {
                const newArray = [...array];
                for (let i = newArray.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
                }
                return newArray;
            }

            // Create a card element - SIMPLIFIED STRUCTURE
            function createCard(data) {
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.id = data.id;
                card.dataset.match = data.match;
                card.setAttribute('tabindex', '0');
                card.setAttribute('role', 'button');
                card.setAttribute('aria-label', getCardAriaLabel(data));
                card.setAttribute('aria-pressed', 'false');
                
                // Create front of card (letter/number)
                const cardFront = document.createElement('div');
                cardFront.className = 'card-front';
                
                if (data.class === 'number-count') {
                    // Create dots representing the number
                    const countContainer = document.createElement('div');
                    countContainer.className = data.class;
                    
                    for (let i = 0; i < data.count; i++) {
                        const dot = document.createElement('span');
                        dot.className = 'number-count-item';
                        countContainer.appendChild(dot);
                    }
                    
                    cardFront.appendChild(countContainer);
                } else {
                    // Simple text content
                    const cardContent = document.createElement('span');
                    cardContent.className = data.class;
                    cardContent.textContent = data.value;
                    cardFront.appendChild(cardContent);
                }
                
                // Create back of card (empty with polka dots)
                const cardBack = document.createElement('div');
                cardBack.className = 'card-back';
                
                // Add both front and back directly to the card
                card.appendChild(cardFront);
                card.appendChild(cardBack);
                
                card.addEventListener('click', flipCard);
                card.addEventListener('keydown', handleCardKeydown);
                
                return card;
            }

            // Get appropriate aria label for each card type
            function getCardAriaLabel(data) {
                if (data.class === 'uppercase') {
                    return `Uppercase letter ${data.value}`;
                } else if (data.class === 'lowercase') {
                    return `Lowercase letter ${data.value}`;
                } else if (data.class === 'number-symbol') {
                    return `Number ${data.value}`;
                } else if (data.class === 'number-count') {
                    return `${data.count} dots representing the number ${data.count}`;
                }
                return 'Card';
            }

            // Handle keyboard navigation for cards
            function handleCardKeydown(e) {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    this.click();
                }
            }

            // Flip a card - Simplified version
            function flipCard() {
                if (lockBoard) return;
                if (this === firstCard) return;
                
                this.classList.add('flipped');
                this.setAttribute('aria-pressed', 'true');
                
                if (!firstCard) {
                    firstCard = this;
                    return;
                }
                
                secondCard = this;
                checkForMatch();
            }

            // Check if the two flipped cards match
            function checkForMatch() {
                lockBoard = true;
                attempts++;
                attemptCount.textContent = attempts;
                
                // Make sure both cards exist before checking match
                if (!firstCard || !secondCard) {
                    resetBoard();
                    return;
                }
                
                const isMatch = firstCard.dataset.match === secondCard.dataset.id;
                
                if (isMatch) {
                    disableCards();
                    matches++;
                    matchCount.textContent = matches;
                    updateProgress();
                    
                    // Add null checks before manipulating classList
                    if (firstCard) firstCard.classList.add('matched-animation');
                    if (secondCard) secondCard.classList.add('matched-animation');
                    setTimeout(() => {
                        if (firstCard) firstCard.classList.remove('matched-animation');
                        if (secondCard) secondCard.classList.remove('matched-animation');
                    }, 1000);
                    
                    if (matches === totalPairs) {
                        setTimeout(() => {
                            showSuccessModal();
                        }, 500);
                    }
                } else {
                    unflipCards();
                    // Add null checks here too
                    if (firstCard) firstCard.classList.add('no-match-animation');
                    if (secondCard) secondCard.classList.add('no-match-animation');
                    setTimeout(() => {
                        if (firstCard) firstCard.classList.remove('no-match-animation');
                        if (secondCard) secondCard.classList.remove('no-match-animation');
                    }, 1000);
                }
            }

            // Disable matched cards
            function disableCards() {
                if (!firstCard || !secondCard) return;
                
                firstCard.classList.add('matched');
                secondCard.classList.add('matched');
                
                firstCard.removeEventListener('click', flipCard);
                secondCard.removeEventListener('click', flipCard);
                
                resetBoard();
            }

            // Unflip cards that don't match
            function unflipCards() {
                setTimeout(() => {
                    if (firstCard) {
                        firstCard.classList.remove('flipped');
                        firstCard.setAttribute('aria-pressed', 'false');
                    }
                    if (secondCard) {
                        secondCard.classList.remove('flipped');
                        secondCard.setAttribute('aria-pressed', 'false');
                    }
                    
                    resetBoard();
                }, 1000);
            }

            // Reset the board after a turn
            function resetBoard() {
                [firstCard, secondCard] = [null, null];
                lockBoard = false;
            }
            
            // Update progress bar
            function updateProgress() {
                const percentage = (matches / totalPairs) * 100;
                progressFill.style.width = `${percentage}%`;
            }
            
            // Create confetti effect
            function createConfetti() {
                if (!confettiWrapper) return; // Skip if element doesn't exist
                
                confettiWrapper.innerHTML = '';
                const colors = ['#2196F3', '#03A9F4', '#00BCD4', '#009688', '#4CAF50'];
                
                for (let i = 0; i < 100; i++) {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'absolute';
                    confetti.style.left = Math.random() * 100 + '%';
                    confetti.style.width = Math.random() * 10 + 5 + 'px';
                    confetti.style.height = Math.random() * 10 + 5 + 'px';
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.opacity = Math.random() + 0.5;
                    confetti.style.top = -20 + 'px';
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                    confetti.style.animation = `fall ${Math.random() * 3 + 2}s linear`;
                    
                    confettiWrapper.appendChild(confetti);
                }
            }

            // Display success modal
            function showSuccessModal() {
                finalAttempts.textContent = attempts;
                if (confettiWrapper) {
                    createConfetti();
                }
                successModal.classList.add('active');
                successModal.removeAttribute('inert');
                playAgainButton.focus();
            }

            // Start a new game
            function startGame() {
                // Reset game state
                gameBoard.innerHTML = '';
                matches = 0;
                attempts = 0;
                matchCount.textContent = '0';
                attemptCount.textContent = '0';
                resetBoard();
                
                // Update total pairs based on difficulty
                if (easyMode.checked) {
                    totalPairs = 6;
                } else if (mediumMode.checked) {
                    totalPairs = 9;
                }
                
                totalPairsElement.textContent = totalPairs;
                updateProgress();
                
                // Generate and shuffle cards
                const shuffledCards = generateCardsData();
                
                // Update board layout based on difficulty
                if (mediumMode.checked) {
                    gameBoard.classList.add('medium');
                } else {
                    gameBoard.classList.remove('medium');
                }
                
                // Create and append cards to the game board
                shuffledCards.forEach((cardData, index) => {
                    const card = createCard(cardData);
                    
                    // Add entry animation
                    card.style.opacity = '0';
                    card.style.transform = 'scale(0.8)';
                    
                    gameBoard.appendChild(card);
                    
                    // Trigger animation with a slight delay based on index
                    setTimeout(() => {
                        card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
                        card.style.opacity = '1';
                        card.style.transform = 'scale(1)';
                    }, index * 50);
                });
            }

            // Start the game on load
            startGame();
        });
    </script>
</body>
</html>